(()=>{var e={};e.id=647,e.ids=[647],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},24429:()=>{},27405:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var s=r(12518);let a=null;async function o(){if(!a){let e=process.env.MONGODB_URI;if(!e)throw Error("MONGODB_URI is not defined");a=new s.MongoClient(e),await a.connect()}return a.db("sunday_school")}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64749:()=>{},97478:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>w,serverHooks:()=>v,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{DELETE:()=>j,GET:()=>p,POST:()=>f,PUT:()=>x});var a=r(30781),o=r(60554),n=r(31625),i=r(27405),u=r(96396),l=r(73885),c=r(12518);let d=[{value:"Attendance Facilitator",label:"Attendance Facilitator"},{value:"Education Facilitator",label:"Education Facilitator"}];async function p(e){if(e.nextUrl.pathname.endsWith("/roles"))return u.NextResponse.json(d,{status:200});try{let e=await (0,i.L)(),t=(await e.collection("users").find({role:{$in:["Attendance Facilitator","Education Facilitator"]}}).project({password:0}).toArray()).map(e=>({...e,_id:e._id.toString()}));return u.NextResponse.json(t,{status:200})}catch(e){return u.NextResponse.json({error:"Failed to fetch facilitators"},{status:500})}}async function f(e){try{let t=await (0,i.L)(),{name:r,email:s,password:a,role:o}=await e.json();if(!s||!a||!o)return u.NextResponse.json({error:"Missing required fields: email, password, and role are required"},{status:400});if(!d.some(e=>e.value===o))return u.NextResponse.json({error:`Invalid role. Must be one of: ${d.map(e=>e.value).join(", ")}`},{status:400});if(await t.collection("users").findOne({email:s}))return u.NextResponse.json({error:"Email already exists"},{status:409});let n=await l.Ay.hash(a,10),c=await t.collection("users").insertOne({name:r,email:s,password:n,role:o});return u.NextResponse.json({_id:c.insertedId.toString(),name:r,email:s,role:o},{status:201})}catch(e){return u.NextResponse.json({error:"Failed to create facilitator"},{status:500})}}async function x(e){try{let t=await (0,i.L)(),{id:r,name:s,email:a,password:o,role:n}=await e.json();if(!r||!a||!n)return u.NextResponse.json({error:"Missing required fields: id, email, and role are required"},{status:400});if(!d.some(e=>e.value===n))return u.NextResponse.json({error:`Invalid role. Must be one of: ${d.map(e=>e.value).join(", ")}`},{status:400});if(!c.ObjectId.isValid(r))return u.NextResponse.json({error:"Invalid facilitator ID"},{status:400});let p={name:s,email:a,role:n};o&&(p.password=await l.Ay.hash(o,10));let f=await t.collection("users").updateOne({_id:new c.ObjectId(r)},{$set:p});if(0===f.matchedCount)return u.NextResponse.json({error:"Facilitator not found"},{status:404});return u.NextResponse.json({message:"Facilitator updated"},{status:200})}catch(e){return u.NextResponse.json({error:"Failed to update facilitator"},{status:500})}}async function j(e){try{let t=await (0,i.L)(),{id:r}=await e.json();if(!r)return u.NextResponse.json({error:"Missing facilitator ID"},{status:400});if(!c.ObjectId.isValid(r))return u.NextResponse.json({error:"Invalid facilitator ID"},{status:400});let s=await t.collection("users").deleteOne({_id:new c.ObjectId(r)});if(0===s.deletedCount)return u.NextResponse.json({error:"Facilitator not found"},{status:404});return u.NextResponse.json({message:"Facilitator deleted"},{status:200})}catch(e){return u.NextResponse.json({error:"Failed to delete facilitator"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/facilitators/route",pathname:"/api/facilitators",filename:"route",bundlePath:"app/api/facilitators/route"},resolvedPagePath:"C:\\Users\\Ym\\Desktop\\Ym\\sunday-school-attendance\\Website\\src\\app\\api\\facilitators\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:R,workUnitAsyncStorage:m,serverHooks:v}=w;function h(){return(0,n.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[625,146,885],()=>r(97478));module.exports=s})();