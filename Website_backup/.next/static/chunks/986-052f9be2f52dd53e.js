"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{30986:(e,r,a)=>{a.r(r),a.d(r,{default:()=>c});var t=a(73365),s=a(1521),l=a(19776),n=a(50627);let o=["ሀና","ሀፒ ቪሌጄ","ሂልሳይድ","ህዳሴ","ሆም ላንድ","ሊዜም","መሪ","ሚሽን","ማርቭል","ሜሪኦን","ምስራቅ","ሰላም","ሳንፎርድ","ሳፋሪ","ስኩል ኦፍ ቱምሮ","ሮፋም","ሽቡአጆርሳ","ቅኔ","ቅዱስ ሚካኤል","ቅድስት ሬዛ","በሻሌ","ቤስት","ቦሌ አዲስ","ነዋይ","ኒሺኒ ሆፕ","ኒው ሰንላይት","ናዝሬት","አቡነ ጎርጎርዮስ","አንድነት","ኢትዮ ፓረንት","እርግብ","ኦዞን","ኪዳነ ምሕረት","ኪፓስ","ካራሎ","ወንድይራድ","ውለታ","የኒፎርም","ያንግሩት","ዳይመንድ","ዴሊቨራንስ","ጂባ","ጊብሰን","ግሎሪ","ጽዮን ማርያም","ፋውንቴን","ፌርዌይ","ፓንቶ ኮርቶር","ፓንቶክራቶን","ቪዥን","ኤልቤተል","ስላሴ ካቴድራል","ሚሸን","አንድነት","72","ራዕይ","ቤ ዘ","ቡርቃ ቦሬ","ሚካኤል","ኤደን","ፊውቸር የዝ","Other"],d=["ጥቁር አባይ/ሚካኤል ጀርባ አካባቢ","ሲቪል ሰርቪስ አካባቢ","ወንድይራድ ት/ቤት አካባቢ","ታቦት ማደሪያ/ኮተቤ ኮሌጅ አካባቢ","ወሰን/አቅም ግንባታ አካባቢ","አልታድ (ፊጋ) አካባቢ","ሴፍ የመኖሪያ ቤቶች አካባቢ","የተባበሩት አካባቢ","ሰሚት አካባቢ","ሲኤምሲ","መሪ","ላምበረት","02","ሰባ ሁለት","ኢትዮ ዋልስ","ሎቄ","ኢትዮ ዊልስ","አቤም","ጣፎ","ሰአሊተ ምሕረት","አያት","ካራ","አባዶ","Other"];function c(){let{status:e}=(0,l.useSession)(),r=(0,n.useRouter)(),[a,c]=(0,s.useState)({First_Name:"",Father_Name:"",Grandfather_Name:"",Mothers_Name:"",Christian_Name:"",DOB_Date:"",DOB_Month:"",DOB_Year:"",Age:0,Sex:"",Class:"",Occupation:"",School:"",School_Other:"",Educational_Background:"",Place_of_Work:"",Address:"",Address_Other:"",Academic_Year:"",Phone_Number:"",Grade:"",Unique_ID:""}),[i,u]=(0,s.useState)(0),[m,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)({});(0,s.useEffect)(()=>{"unauthenticated"===e&&(window.location.href="/login")},[e]),(0,s.useEffect)(()=>{"authenticated"===e&&a.Grade&&a.Academic_Year&&/^\d{4}$/.test(a.Academic_Year)&&(h(!0),fetch("/api/students/count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({academicYear:a.Academic_Year,grade:a.Grade})}).then(e=>{if(!e.ok)throw Error("Fetch failed: ".concat(e.status," ").concat(e.statusText));return e.json()}).then(e=>{var r,t;let s=e.count+1,l=a.Academic_Year.slice(-2),n=(null==(t=a.Grade.match(/\d+/))||null==(r=t[0])?void 0:r.padStart(2,"0"))||"01",o="ብሕ/".concat(l,"/").concat(n,"/").concat(String(s).padStart(2,"0"));c(e=>({...e,Unique_ID:o}))}).catch(e=>{u(0),c(e=>({...e,Unique_ID:""})),g(r=>({...r,Unique_ID:"Error generating ID: ".concat(e.message)}))}).finally(()=>{h(!1)}))},[e,a.Academic_Year,a.Grade]);let _=(e,r,a)=>2017-a;(0,s.useEffect)(()=>{if(a.DOB_Date&&a.DOB_Month&&a.DOB_Year){let e=_(parseInt(a.DOB_Date),parseInt(a.DOB_Month),parseInt(a.DOB_Year));e>=0&&c(r=>({...r,Age:e}))}},[a.DOB_Date,a.DOB_Month,a.DOB_Year]);let p=()=>{let e={};return Object.keys(a).forEach(r=>{a[r]||"School_Other"===r||"Address_Other"===r||"Educational_Background"===r||"Place_of_Work"===r||"School"===r||"Age"===r||"Class"===r||"Unique_ID"===r||(e[r]="".concat(r.replace("_"," ")," is required"))}),"Student"!==a.Occupation||a.Class||(e.Class="Class is required for students"),["First_Name","Father_Name","Grandfather_Name","Mothers_Name","Christian_Name","Sex","Occupation","Address"].forEach(r=>{a[r]&&/\d/.test(a[r])&&(e[r]="".concat(r.replace("_"," ")," cannot contain numbers"))}),["DOB_Date","DOB_Month","DOB_Year","Phone_Number","Academic_Year"].forEach(r=>{a[r]&&!/^\d+$/.test(a[r])&&(e[r]="".concat(r.replace("_"," ")," must contain numbers only"))}),a.Academic_Year&&!/^\d{4}$/.test(a.Academic_Year)&&(e.Academic_Year="Academic Year must be a 4-digit number"),"Student"!==a.Occupation||a.School||(e.School="School is required for students"),"Worker"===a.Occupation&&(a.Educational_Background||(e.Educational_Background="Educational Background is required for workers"),a.Place_of_Work||(e.Place_of_Work="Place of Work is required for workers")),"Other"!==a.Address||a.Address_Other||(e.Address_Other="Please specify address"),"Other"!==a.School||a.School_Other||(e.School_Other="Please specify school"),a.Unique_ID||m||(e.Unique_ID="ID Number is required"),g(e),0===Object.keys(e).length},f=async()=>{try{let e=await fetch("/api/students/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({First_Name:a.First_Name,Father_Name:a.Father_Name,Grandfather_Name:a.Grandfather_Name,Mothers_Name:a.Mothers_Name,Sex:a.Sex})});if(!e.ok)throw Error("Failed to check duplicate");let{exists:r}=await e.json();return r}catch(e){return!1}},b=async e=>{if(e.preventDefault(),!p())return void alert("Please fix form errors");if(await f())return void alert("Student already exists.");try{let e={...a,School:"Other"===a.School?a.School_Other:a.School,Address:"Other"===a.Address?a.Address_Other:a.Address};if(!(await fetch("/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to register student");alert("Student registered successfully!"),r.push("/register/old")}catch(e){alert("Registration failed: ".concat(e.message))}},N=e=>{let{name:r,value:a}=e.target;c(e=>({...e,[r]:j.includes(r)?a.replace(/[^\d]/g,""):a})),g(e=>({...e,[r]:""}))},j=["DOB_Date","DOB_Month","DOB_Year","Phone_Number","Academic_Year"];return"loading"===e?(0,t.jsx)("div",{children:"Loading..."}):(0,t.jsxs)("section",{className:"bg-white shadow-lg rounded-lg p-6 max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-4xl font-extrabold text-blue-800 mb-2 text-center",children:"New Student Registration"}),(0,t.jsx)("p",{className:"text-lg text-gray-600 mb-8 text-center",children:"Fill in the details below to register a new student for Sunday School."}),(0,t.jsxs)("form",{onSubmit:b,className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6",children:[(0,t.jsx)("div",{className:"md:col-span-2 mb-2",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-blue-700 border-b pb-1 mb-2",children:"Personal Information"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"First_Name",className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,t.jsx)("input",{type:"text",id:"First_Name",name:"First_Name",value:a.First_Name,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., ዮሐንስ",required:!0}),x.First_Name&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.First_Name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Father_Name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Father Name"}),(0,t.jsx)("input",{type:"text",id:"Father_Name",name:"Father_Name",value:a.Father_Name,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., ተክለ",required:!0}),x.Father_Name&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Father_Name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Grandfather_Name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Grandfather Name"}),(0,t.jsx)("input",{type:"text",id:"Grandfather_Name",name:"Grandfather_Name",value:a.Grandfather_Name,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., ዳዊት",required:!0}),x.Grandfather_Name&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Grandfather_Name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Mothers_Name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mother's Name"}),(0,t.jsx)("input",{type:"text",id:"Mothers_Name",name:"Mothers_Name",value:a.Mothers_Name,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., ማርያም",required:!0}),x.Mothers_Name&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Mothers_Name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Christian_Name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Christian Name"}),(0,t.jsx)("input",{type:"text",id:"Christian_Name",name:"Christian_Name",value:a.Christian_Name,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., ገብርኤል",required:!0}),x.Christian_Name&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Christian_Name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth (Ethiopian Calendar)"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,t.jsx)("input",{type:"text",name:"DOB_Date",value:a.DOB_Date,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"Date, e.g., 15",required:!0}),(0,t.jsx)("input",{type:"text",name:"DOB_Month",value:a.DOB_Month,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"Month, e.g., 6",required:!0}),(0,t.jsx)("input",{type:"text",name:"DOB_Year",value:a.DOB_Year,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"Year, e.g., 2005",required:!0})]}),(x.DOB_Date||x.DOB_Month||x.DOB_Year)&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.DOB_Date||x.DOB_Month||x.DOB_Year})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Age",className:"block text-sm font-medium text-gray-700 mb-1",children:"Age (Calculated)"}),(0,t.jsx)("input",{type:"number",id:"Age",name:"Age",value:a.Age,readOnly:!0,className:"p-3 border rounded-lg w-full bg-gray-100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Sex",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sex"}),(0,t.jsxs)("select",{id:"Sex",name:"Sex",value:a.Sex,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Sex"}),(0,t.jsx)("option",{value:"Male",children:"Male"}),(0,t.jsx)("option",{value:"Female",children:"Female"})]}),x.Sex&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Sex})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Phone_Number",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,t.jsx)("input",{type:"text",id:"Phone_Number",name:"Phone_Number",value:a.Phone_Number,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., 0912345678",required:!0}),x.Phone_Number&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Phone_Number})]}),(0,t.jsx)("div",{className:"md:col-span-2 mt-4 mb-2",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-blue-700 border-b pb-1 mb-2",children:"Academic & School Information"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Occupation",className:"block text-sm font-medium text-gray-700 mb-1",children:"Occupation"}),(0,t.jsxs)("select",{id:"Occupation",name:"Occupation",value:a.Occupation,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Occupation"}),(0,t.jsx)("option",{value:"Student",children:"Student"}),(0,t.jsx)("option",{value:"Worker",children:"Worker"})]}),x.Occupation&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Occupation})]}),"Student"===a.Occupation&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Class",className:"block text-sm font-medium text-gray-700 mb-1",children:"Class (World School)"}),(0,t.jsxs)("select",{id:"Class",name:"Class",value:a.Class,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Class"}),[...Array(12)].map((e,r)=>(0,t.jsxs)("option",{value:"Grade ".concat(1+r),children:["Grade ",1+r]},r)),(0,t.jsx)("option",{value:"University",children:"University"})]}),x.Class&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Class})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"School",className:"block text-sm font-medium text-gray-700 mb-1",children:"School"}),(0,t.jsxs)("select",{id:"School",name:"School",value:a.School,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select School"}),o.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),x.School&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.School})]}),"Other"===a.School&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"School_Other",className:"block text-sm font-medium text-gray-700 mb-1",children:"Other School"}),(0,t.jsx)("input",{type:"text",id:"School_Other",name:"School_Other",value:a.School_Other,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0}),x.School_Other&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.School_Other})]})]}),"Worker"===a.Occupation&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Educational_Background",className:"block text-sm font-medium text-gray-700 mb-1",children:"Educational Background"}),(0,t.jsxs)("select",{id:"Educational_Background",name:"Educational_Background",value:a.Educational_Background,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Educational Background"}),(0,t.jsx)("option",{value:"1-8",children:"1-8"}),(0,t.jsx)("option",{value:"9-12",children:"9-12"}),(0,t.jsx)("option",{value:"University",children:"University"})]}),x.Educational_Background&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Educational_Background})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Place_of_Work",className:"block text-sm font-medium text-gray-700 mb-1",children:"Place of Work"}),(0,t.jsxs)("select",{id:"Place_of_Work",name:"Place_of_Work",value:a.Place_of_Work,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Place of Work"}),(0,t.jsx)("option",{value:"Government",children:"Government"}),(0,t.jsx)("option",{value:"Private",children:"Private"})]}),x.Place_of_Work&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Place_of_Work})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,t.jsxs)("select",{id:"Address",name:"Address",value:a.Address,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Address"}),d.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),x.Address&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Address})]}),"Other"===a.Address&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Address_Other",className:"block text-sm font-medium text-gray-700 mb-1",children:"Other Address"}),(0,t.jsx)("input",{type:"text",id:"Address_Other",name:"Address_Other",value:a.Address_Other,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0}),x.Address_Other&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Address_Other})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Grade",className:"block text-sm font-medium text-gray-700 mb-1",children:"Grade (Sunday School)"}),(0,t.jsxs)("select",{id:"Grade",name:"Grade",value:a.Grade,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Grade"}),[...Array(12)].map((e,r)=>(0,t.jsxs)("option",{value:"Grade ".concat(1+r),children:["Grade ",1+r]},r))]}),x.Grade&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Grade})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Academic_Year",className:"block text-sm font-medium text-gray-700 mb-1",children:"Academic Year (Ethiopian Calendar)"}),(0,t.jsx)("input",{type:"text",id:"Academic_Year",name:"Academic_Year",value:a.Academic_Year,onChange:N,className:"p-3 border rounded-lg w-full focus:ring-2 focus:ring-blue-300",placeholder:"e.g., 2017",required:!0}),x.Academic_Year&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Academic_Year})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Unique_ID",className:"block text-sm font-medium text-gray-700 mb-1",children:"ID Number"}),(0,t.jsx)("input",{type:"text",id:"Unique_ID",name:"Unique_ID",value:a.Unique_ID||"",readOnly:!0,className:"p-3 border rounded-lg w-full bg-gray-100",disabled:m}),m&&(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"Generating ID..."}),x.Unique_ID&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.Unique_ID})]}),(0,t.jsx)("div",{className:"md:col-span-2 flex gap-4 mt-8 justify-center",children:(0,t.jsx)("button",{type:"submit",className:"bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-3 rounded-xl text-lg font-semibold shadow-lg hover:from-green-600 hover:to-blue-600 transition disabled:bg-gray-400",disabled:m,children:"Register Student"})})]})]})}},50627:(e,r,a)=>{var t=a(47192);a.o(t,"useParams")&&a.d(r,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(r,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(r,{useRouter:function(){return t.useRouter}})}}]);