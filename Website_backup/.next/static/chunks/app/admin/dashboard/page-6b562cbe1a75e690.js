(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{4440:(e,a,t)=>{Promise.resolve().then(t.bind(t,58379))},58379:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>d});var l=t(73365),s=t(1521);function r(e,a){let t=new Blob([[Object.keys(e[0]||{}).join(","),...e.map(e=>Object.values(e).map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(","))].join("\n")],{type:"text/csv"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=a,s.click(),URL.revokeObjectURL(l)}function d(){let[e,a]=(0,s.useState)([]),[t,d]=(0,s.useState)([]),[n,i]=(0,s.useState)([]),[c,o]=(0,s.useState)(!0),[x,h]=(0,s.useState)(null),[m,u]=(0,s.useState)(""),[b,p]=(0,s.useState)(""),[g,j]=(0,s.useState)(1),[N,f]=(0,s.useState)(1),[v,y]=(0,s.useState)(!1),[w,S]=(0,s.useState)(null),[C,k]=(0,s.useState)({name:"",email:"",password:"",role:"facilitator1"}),[_,E]=(0,s.useState)(null),[A,F]=(0,s.useState)(!1),[L,P]=(0,s.useState)([]);function R(){o(!0),Promise.all([fetch("/api/students").then(e=>e.json()),fetch("/api/facilitators").then(e=>e.json()),fetch("/api/attendance").then(e=>e.json())]).then(e=>{let[t,l,s]=e;a(Array.isArray(t)?t:[]),d(Array.isArray(l)?l:[]),i(Array.isArray(s)?s:[]),o(!1)}).catch(()=>{h("Failed to load dashboard data"),o(!1)})}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;S(e),k(e?{name:e.name||"",email:e.email,password:"",role:e.role}:{name:"",email:"",password:"",role:"facilitator1"}),E(null),y(!0)}function M(){y(!1),S(null),k({name:"",email:"",password:"",role:"facilitator1"}),E(null)}async function U(e){e.preventDefault(),F(!0),E(null);let a=w?"PUT":"POST",t=w?{...C,id:w._id}:C,l=await fetch("/api/facilitators",{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});l.ok?(M(),R()):E((await l.json()).error||"Failed to save facilitator"),F(!1)}async function D(e){confirm("Are you sure you want to delete this facilitator?")&&(F(!0),(await fetch("/api/facilitators",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok&&R(),F(!1))}(0,s.useEffect)(()=>{R(),fetch("/api/facilitators/roles").then(e=>e.json()).then(P)},[]);let q=e.filter(e=>[e.Unique_ID,e.First_Name,e.Father_Name,e.Grade,e.Sex].join(" ").toLowerCase().includes(m.toLowerCase())),T=t.filter(e=>[e.name,e.email,e.role].join(" ").toLowerCase().includes(b.toLowerCase())),G=q.slice((g-1)*10,10*g),I=T.slice((N-1)*10,10*N),z=Math.ceil(q.length/10),J=Math.ceil(T.length/10),V=n.length,B=n.filter(e=>e.present).length,H=V>0?Math.round(B/V*100):0;return(0,l.jsxs)("div",{className:"min-h-screen flex flex-col gap-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-extrabold text-blue-900 mb-4",children:"Admin Dashboard"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-xl p-6 flex flex-col items-center",children:[(0,l.jsx)("span",{className:"text-2xl font-bold text-blue-700",children:c?"-":e.length}),(0,l.jsx)("span",{className:"text-gray-600 mt-2",children:"Total Students"})]}),(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-xl p-6 flex flex-col items-center",children:[(0,l.jsx)("span",{className:"text-2xl font-bold text-green-700",children:c?"-":t.length}),(0,l.jsx)("span",{className:"text-gray-600 mt-2",children:"Facilitators"})]}),(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-xl p-6 flex flex-col items-center",children:[(0,l.jsx)("span",{className:"text-2xl font-bold text-yellow-600",children:c?"-":"".concat(H,"%")}),(0,l.jsx)("span",{className:"text-gray-600 mt-2",children:"Attendance Rate"})]}),(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-xl p-6 flex flex-col items-center",children:[(0,l.jsx)("span",{className:"text-2xl font-bold text-purple-700",children:c?"-":"3"}),(0,l.jsx)("span",{className:"text-gray-600 mt-2",children:"Reports"})]})]}),(0,l.jsxs)("div",{className:"bg-white shadow rounded-xl p-6 mb-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-blue-800",children:"Student Records"}),(0,l.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",onClick:()=>r(q,"students.csv"),disabled:0===q.length,children:"Export CSV"})]}),(0,l.jsx)("input",{type:"text",placeholder:"Search students...",className:"mb-4 p-2 border rounded w-full max-w-xs",value:m,onChange:e=>{u(e.target.value),j(1)}}),c?(0,l.jsx)("div",{className:"text-gray-500",children:"Loading students..."}):x?(0,l.jsx)("div",{className:"text-red-500",children:x}):(0,l.jsxs)("div",{className:"overflow-x-auto max-h-[400px]",children:[(0,l.jsxs)("table",{className:"min-w-full border-collapse border",children:[(0,l.jsx)("thead",{className:"bg-gray-100",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"border p-3 text-left",children:"ID Number"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Name"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Grade"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Sex"})]})}),(0,l.jsx)("tbody",{children:G.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"border p-3",children:e.Unique_ID}),(0,l.jsx)("td",{className:"border p-3",children:"".concat(e.First_Name," ").concat(e.Father_Name)}),(0,l.jsx)("td",{className:"border p-3",children:e.Grade}),(0,l.jsx)("td",{className:"border p-3",children:e.Sex})]},e._id))})]}),(0,l.jsxs)("div",{className:"flex gap-2 mt-4 justify-center",children:[(0,l.jsx)("button",{className:"px-3 py-1 rounded border bg-gray-100",onClick:()=>j(e=>Math.max(1,e-1)),disabled:1===g,children:"Prev"}),(0,l.jsxs)("span",{className:"px-2",children:["Page ",g," of ",z]}),(0,l.jsx)("button",{className:"px-3 py-1 rounded border bg-gray-100",onClick:()=>j(e=>Math.min(z,e+1)),disabled:g===z,children:"Next"})]})]})]}),(0,l.jsxs)("div",{className:"bg-white shadow rounded-xl p-6 mb-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-blue-800",children:"Facilitator Management"}),(0,l.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",onClick:()=>O(),children:"+ Add Facilitator"}),(0,l.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 ml-2",onClick:()=>r(T,"facilitators.csv"),disabled:0===T.length,children:"Export CSV"})]}),(0,l.jsx)("input",{type:"text",placeholder:"Search facilitators...",className:"mb-4 p-2 border rounded w-full max-w-xs",value:b,onChange:e=>{p(e.target.value),f(1)}}),c?(0,l.jsx)("div",{className:"text-gray-500",children:"Loading facilitators..."}):x?(0,l.jsx)("div",{className:"text-red-500",children:x}):(0,l.jsxs)("div",{className:"overflow-x-auto max-h-[300px]",children:[(0,l.jsxs)("table",{className:"min-w-full border-collapse border",children:[(0,l.jsx)("thead",{className:"bg-gray-100",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"border p-3 text-left",children:"Name"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Email"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Role"}),(0,l.jsx)("th",{className:"border p-3 text-left",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:I.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"border p-3",children:e.name||"-"}),(0,l.jsx)("td",{className:"border p-3",children:e.email}),(0,l.jsx)("td",{className:"border p-3 capitalize",children:e.role}),(0,l.jsxs)("td",{className:"border p-3 flex gap-2",children:[(0,l.jsx)("button",{className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",onClick:()=>O(e),children:"Edit"}),(0,l.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700",onClick:()=>D(e._id),disabled:A,children:"Delete"})]})]},e._id))})]}),(0,l.jsxs)("div",{className:"flex gap-2 mt-4 justify-center",children:[(0,l.jsx)("button",{className:"px-3 py-1 rounded border bg-gray-100",onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===N,children:"Prev"}),(0,l.jsxs)("span",{className:"px-2",children:["Page ",N," of ",J]}),(0,l.jsx)("button",{className:"px-3 py-1 rounded border bg-gray-100",onClick:()=>f(e=>Math.min(J,e+1)),disabled:N===J,children:"Next"})]})]}),v&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 w-full max-w-md relative",children:[(0,l.jsx)("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl",onClick:M,children:"\xd7"}),(0,l.jsx)("h3",{className:"text-xl font-bold mb-4",children:w?"Edit Facilitator":"Add Facilitator"}),(0,l.jsxs)("form",{onSubmit:U,className:"flex flex-col gap-4",children:[(0,l.jsx)("input",{type:"text",placeholder:"Name",className:"p-3 border rounded-lg",value:C.name,onChange:e=>k({...C,name:e.target.value}),required:!0}),(0,l.jsx)("input",{type:"email",placeholder:"Email",className:"p-3 border rounded-lg",value:C.email,onChange:e=>k({...C,email:e.target.value}),required:!0,disabled:!!w}),(0,l.jsx)("input",{type:"password",placeholder:w?"New Password (leave blank to keep)":"Password",className:"p-3 border rounded-lg",value:C.password,onChange:e=>k({...C,password:e.target.value}),minLength:6*!w,required:!w}),(0,l.jsx)("select",{className:"p-3 border rounded-lg",value:C.role,onChange:e=>k({...C,role:e.target.value}),required:!0,children:L.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))}),_&&(0,l.jsx)("div",{className:"text-red-500 text-sm",children:_}),(0,l.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400",disabled:A,children:A?"Saving...":w?"Update Facilitator":"Add Facilitator"})]})]})})]}),(0,l.jsxs)("div",{className:"bg-white shadow rounded-xl p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-blue-800 mb-4",children:"Reports"}),(0,l.jsx)("div",{className:"text-gray-500",children:"[Reports and export options will go here]"})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[2347,4870,7358],()=>a(4440)),_N_E=e.O()}]);