(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2639],{276:(e,t,a)=>{Promise.resolve().then(a.bind(a,43533))},14130:(e,t,a)=>{"use strict";a.d(t,{II:()=>s,fb:()=>r,hd:()=>l,lB:()=>n});let s=["Meskerem","Tikimt","Hidar","Tahsas","Tir","Yekatit","Megabit","Miyazia","Ginbot","Sene","Hamle","Nehase","PagumÄ“"];function r(e){let t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate();return"".concat(s,"/").concat(a,"/").concat(t-7)}function n(e){let[t,a,s]=e.split("/").map(Number);return new Date(s+7,a-1,t)}function l(e){let t=parseInt(e),a=[];for(let e=1;e<=12;e++)for(let s=1;s<=30;s++)s%7==0&&a.push("".concat(s,"/").concat(e,"/").concat(t));return a}},30402:()=>{},43533:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var s=a(73365),r=a(1521),n=a(30986),l=a(59534),o=a.n(l);function d(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[h,x]=(0,r.useState)(""),[b,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{fetch("/api/students").then(e=>e.json()).then(e=>t(e)).catch(()=>t([]))},[]);let f=Math.max(...e.map(e=>parseInt(e.Academic_Year)).filter(Boolean)),g=e.filter(e=>e.Academic_Year===String(f)),j=[...new Set(g.map(e=>e.Grade))].sort(),v=[...new Set(g.map(e=>e.Sex))].sort(),N=g.filter(e=>(""===l||e.Grade===l)&&(""===i||e.Sex===i)&&((e.Unique_ID||"").toLowerCase().includes(a.toLowerCase())||(e.First_Name||"").toLowerCase().includes(a.toLowerCase())||(e.Father_Name||"").toLowerCase().includes(a.toLowerCase())||(e.Grade||"").toLowerCase().includes(a.toLowerCase())));return(0,s.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Current Year Student List"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),(0,s.jsx)("input",{type:"text",id:"search",placeholder:"Search by ID, Name, or Grade",value:a,onChange:e=>n(e.target.value),className:"w-full p-3 border rounded-lg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"gradeFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Grade"}),(0,s.jsxs)("select",{id:"gradeFilter",value:l,onChange:e=>d(e.target.value),className:"w-full p-3 border rounded-lg",children:[(0,s.jsx)("option",{value:"",children:"All Grades"}),j.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"sexFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Sex"}),(0,s.jsxs)("select",{id:"sexFilter",value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border rounded-lg",children:[(0,s.jsx)("option",{value:"",children:"Both"}),v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto max-h-[500px]",children:(0,s.jsxs)("table",{className:"min-w-full border-collapse border",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border p-3 text-left",children:"ID Number"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Name"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Grade"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Sex"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Details"})]})}),(0,s.jsx)("tbody",{children:N.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"border p-3",children:e.Unique_ID}),(0,s.jsx)("td",{className:"border p-3",children:"".concat(e.First_Name," ").concat(e.Father_Name)}),(0,s.jsx)("td",{className:"border p-3",children:e.Grade}),(0,s.jsx)("td",{className:"border p-3",children:e.Sex}),(0,s.jsx)("td",{className:"border p-3 text-center",children:(0,s.jsx)(o(),{href:"/facilitator/attendance/students/".concat(e._id),className:"bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700",children:"Details"})})]},e._id))})]})})]})}var i=a(37401),c=a(77328),u=a(14130);function m(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(""),[l,o]=(0,r.useState)(""),d=new Date,m=(0,u.fb)(d),[h,x]=(0,r.useState)([]),[b,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p(0===d.getDay()),fetch("/api/students").then(e=>e.json()).then(e=>t(e)).catch(()=>t([]))},[]);let f=Math.max(...e.map(e=>parseInt(e.Academic_Year)).filter(Boolean)),g=e.filter(e=>e.Academic_Year===String(f)),j=e=>{if(!b)return alert("Attendance can only be marked on Sundays");x(h.find(t=>t.studentId===e&&t.date===m)?h.map(t=>t.studentId===e&&t.date===m?{...t,present:!t.present,hasPermission:!1}:t):[...h,{studentId:e,date:m,present:!0,hasPermission:!1}])},v=e=>{if(!b)return alert("Permission can only be marked on Sundays");x(h.find(t=>t.studentId===e&&t.date===m)?h.map(t=>t.studentId===e&&t.date===m?{...t,hasPermission:!t.hasPermission,present:!1}:t):[...h,{studentId:e,date:m,present:!1,hasPermission:!0}])},N=()=>{if(!e)return;let t=g.map(e=>{var t,a;return{Unique_ID:e.Unique_ID,First_Name:e.First_Name,Father_Name:e.Father_Name,Class:e.Class,Status:(null==(t=h.find(t=>t.studentId===e._id&&t.date===m))?void 0:t.present)?"Present":(null==(a=h.find(t=>t.studentId===e._id&&t.date===m))?void 0:a.hasPermission)?"Permission":"Absent",Date:m}}),a=i.Wp.json_to_sheet(t),s=i.Wp.book_new();i.Wp.book_append_sheet(s,a,"Attendance");let r=i.M9(s,{bookType:"xlsx",type:"array"});(0,c.saveAs)(new Blob([r],{type:"application/octet-stream"}),"Attendance_".concat(m.replace(/[\s,]+/g,"_"),".xlsx"))},w=(null==g?void 0:g.filter(e=>e._id&&(""===l||e.Grade===l)&&((e.Unique_ID||"").toLowerCase().includes(a.toLowerCase())||(e.First_Name||"").toLowerCase().includes(a.toLowerCase())||(e.Father_Name||"").toLowerCase().includes(a.toLowerCase())||(e.Grade||"").toLowerCase().includes(a.toLowerCase()))))||[];return(0,s.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Attendance Management"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,s.jsx)("p",{className:"p-3 border border-gray-300 rounded-lg bg-gray-50",children:m}),!b&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:"Attendance can only be marked on Sundays"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by ID, Name, or Class",value:a,onChange:e=>n(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg"})]})]}),(0,s.jsxs)("form",{onSubmit:e=>(e.preventDefault(),b)?h.some(e=>e.date===m&&(e.present||e.hasPermission))?void(N(),alert("Attendance submitted successfully!"),x([])):alert("Please mark at least one student as Present or with Permission"):alert("Attendance can only be submitted on Sundays"),className:"mb-6 flex justify-between items-end",children:[(0,s.jsxs)("div",{className:"w-1/2",children:[(0,s.jsx)("label",{htmlFor:"classFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Grade"}),(0,s.jsxs)("select",{id:"classFilter",value:l,onChange:e=>o(e.target.value),className:"w-full p-3 border rounded-lg",children:[(0,s.jsx)("option",{value:"",children:"All Grades"}),[...new Set((null==g?void 0:g.map(e=>e.Grade))||[])].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700",children:"Submit"})]}),(0,s.jsx)("div",{className:"overflow-x-auto max-h-[500px]",children:(0,s.jsxs)("table",{className:"min-w-full border-collapse border",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border p-3 text-left",children:"ID Number"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Name"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Grade"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Present"}),(0,s.jsx)("th",{className:"border p-3 text-left",children:"Permission"})]})}),(0,s.jsx)("tbody",{children:w.map(e=>{let t=h.find(t=>t.studentId===e._id&&t.date===m);return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"border p-3",children:e.Unique_ID}),(0,s.jsx)("td",{className:"border p-3",children:"".concat(e.First_Name," ").concat(e.Father_Name)}),(0,s.jsx)("td",{className:"border p-3",children:e.Grade}),(0,s.jsx)("td",{className:"border p-3 text-center",children:(0,s.jsx)("input",{type:"checkbox",checked:!!(null==t?void 0:t.present),onChange:()=>e._id&&j(e._id),disabled:!b})}),(0,s.jsx)("td",{className:"border p-3 text-center",children:(0,s.jsx)("input",{type:"checkbox",checked:!!(null==t?void 0:t.hasPermission),onChange:()=>e._id&&v(e._id),disabled:!b})})]},e._id)})})]})})]})}var h=a(19776);let x=[{key:"attendance",label:"Attendance Management"},{key:"register",label:"Register New Student"},{key:"list",label:"Student List"}];function b(){let[e,t]=(0,r.useState)("attendance");return(0,s.jsxs)("div",{className:"flex min-h-screen",children:[(0,s.jsxs)("aside",{className:"w-64 bg-green-900 text-white shadow-lg flex flex-col p-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-8",children:"Attendance Facilitator"}),(0,s.jsxs)("nav",{className:"flex flex-col gap-4",children:[x.map(a=>(0,s.jsx)("button",{className:"text-left px-4 py-2 rounded-lg ".concat(e===a.key?"bg-green-700":"hover:bg-green-700"),onClick:()=>t(a.key),children:a.label},a.key)),(0,s.jsx)("button",{className:"text-left px-4 py-2 rounded-lg hover:bg-blue-700",onClick:()=>(0,h.signOut)({callbackUrl:"/login"}),children:"Logout"})]})]}),(0,s.jsxs)("main",{className:"flex-1 p-8 bg-gray-50",children:["register"===e&&(0,s.jsx)(n.default,{}),"list"===e&&(0,s.jsx)(d,{}),"attendance"===e&&(0,s.jsx)(m,{})]})]})}},57571:()=>{},77328:function(e,t,a){var s,r;void 0===(r="function"==typeof(s=function(){"use strict";function t(e,t,a){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){o(s.response,t,a)},s.onerror=function(){console.error("could not download file")},s.send()}function s(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a.g&&a.g.global===a.g?a.g:void 0,l=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(e,a,l){var o=n.URL||n.webkitURL,d=document.createElement("a");d.download=a=a||e.name||"download",d.rel="noopener","string"==typeof e?(d.href=e,d.origin===location.origin?r(d):s(d.href)?t(e,a,l):r(d,d.target="_blank")):(d.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(d.href)},4e4),setTimeout(function(){r(d)},0))}:"msSaveOrOpenBlob"in navigator?function(e,a,n){if(a=a||e.name||"download","string"!=typeof e){var l;navigator.msSaveOrOpenBlob((void 0===(l=n)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),a)}else if(s(e))t(e,a,n);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){r(o)})}}:function(e,a,s,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return t(e,a,s);var o="application/octet-stream"===e.type,d=/constructor/i.test(n.HTMLElement)||n.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||o&&d||l)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},c.readAsDataURL(e)}else{var u=n.URL||n.webkitURL,m=u.createObjectURL(e);r?r.location=m:location.href=m,r=null,setTimeout(function(){u.revokeObjectURL(m)},4e4)}});n.saveAs=o.saveAs=o,e.exports=o})?s.apply(t,[]):s)||(e.exports=r)}},e=>{var t=t=>e(e.s=t);e.O(0,[8874,9776,9534,986,2347,4870,7358],()=>t(276)),_N_E=e.O()}]);