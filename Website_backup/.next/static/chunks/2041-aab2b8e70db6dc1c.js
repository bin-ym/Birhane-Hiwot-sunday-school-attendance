"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2041],{8735:(e,t,a)=>{a.d(t,{A:()=>m});var s=a(73365),r=a(1521),n=a(62041),i=a(6522),l=a(14130),o=a(72208),d=a(64248),c=a(36864);function m(e){let{student:t,attendanceRecords:a,currentDate:m}=e,[h,u]=(0,r.useState)(!1),x=(0,l.hd)(t.Academic_Year),b=x.reduce((e,t)=>{let[a]=t.split(" ");return e[a]||(e[a]=[]),e[a].push(t),e},{}),g=Object.fromEntries(a.map(e=>[e.date,e])),p=x.length,N=x.filter(e=>{var t;return null==(t=g[e])?void 0:t.present}).length,j=x.filter(e=>{var t,a;return!(null==(t=g[e])?void 0:t.present)&&(null==(a=g[e])?void 0:a.hasPermission)}).length,y=e=>'"'.concat((null==e?void 0:e.replace(/"/g,'""'))||"",'"'),f=()=>{let e=x.map(e=>{let a=g[e];return{Student:"".concat(t.First_Name," ").concat(t.Father_Name),Date:e,Present:(null==a?void 0:a.present)?"Yes":"No",Permission:(null==a?void 0:a.hasPermission)?"Yes":"No",Reason:(null==a?void 0:a.reason)||"",MarkedBy:(null==a?void 0:a.markedBy)||"Birhaun Hiwot",Timestamp:(null==a?void 0:a.timestamp)||new Date().toISOString()}}),a=new Blob([[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).map(e=>y(String(e))).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download="".concat(t.First_Name,"_Attendance.csv"),r.click()},v=()=>{let e=new n.uE;e.setFontSize(14);let a="Attendance Report for ".concat(t.First_Name," ").concat(t.Father_Name);e.text(a,14,20);let s=x.map(e=>{let t=g[e],a=t?t.present?"Present":t.hasPermission?"Permission":"Absent":"Absent";return[e,a,(null==t?void 0:t.reason)||("Permission"===a?"—":"N/A"),(null==t?void 0:t.markedBy)||"Birhaun Hiwot",(null==t?void 0:t.timestamp)?new Date(t.timestamp).toLocaleString():new Date().toLocaleString()]});(0,i.Ay)(e,{head:[["Date","Status","Reason","Marked By","Timestamp"]],body:s,startY:30,styles:{fontSize:10},headStyles:{fillColor:[33,37,41]},alternateRowStyles:{fillColor:[245,245,245]}}),e.save("".concat(t.First_Name,"_Attendance_Report.pdf"))},w=e=>{"CSV"===e?f():"PDF"===e&&v(),u(!1)};return(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-2xl font-semibold text-gray-700",children:["Attendance for Academic Year ",t.Academic_Year]}),(0,s.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Generate Report"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-800 font-medium mb-6",children:[(0,s.jsxs)("div",{className:"bg-green-100 px-3 py-1 rounded-full",children:["Present: ",N,"/",p," (",(N/p*100).toFixed(0),"%)"]}),(0,s.jsxs)("div",{className:"bg-yellow-100 px-3 py-1 rounded-full",children:["Permission: ",j]}),(0,s.jsxs)("div",{className:"bg-red-100 px-3 py-1 rounded-full",children:["Absent: ",p-N-j]})]}),h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",onClick:()=>u(!1),children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Choose Report Format"}),(0,s.jsxs)("div",{className:"flex justify-around",children:[(0,s.jsx)("button",{onClick:()=>w("CSV"),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Export as CSV"}),(0,s.jsx)("button",{onClick:()=>w("PDF"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Generate PDF"})]}),(0,s.jsx)("button",{onClick:()=>u(!1),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Cancel"})]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:0===Object.keys(b).length?(0,s.jsxs)("p",{className:"text-gray-600",children:["No Sundays found for ",t.Academic_Year,"."]}):(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:Object.entries(b).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"bg-gradient-to-r from-gray-50 to-white border border-gray-300 rounded-xl shadow-lg p-5 hover:shadow-xl transition-shadow duration-300",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:t}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:a.map(e=>{let t=(0,l.lB)(e),a=g[e],r="",n="",i=null;t>m?r="":a?(n="Present"==(r=a.present?"Present":a.hasPermission?"Permission":"Absent")?"bg-green-500 text-white":"Permission"===r?"bg-yellow-500 text-white":"bg-red-500 text-white",i="Present"===r?(0,s.jsx)(o.A,{className:"w-5 h-5 inline-block mr-1"}):"Permission"===r?(0,s.jsx)(d.A,{className:"w-5 h-5 inline-block mr-1"}):(0,s.jsx)(c.A,{className:"w-5 h-5 inline-block mr-1"})):(r="Absent",n="bg-red-500 text-white");let h="Marked by: ".concat((null==a?void 0:a.markedBy)||"Birhaun Hiwot","\nTime: ").concat((null==a?void 0:a.timestamp)?new Date(a.timestamp).toLocaleString():new Date().toLocaleString(),"\nReason: ").concat("Permission"===r?(null==a?void 0:a.reason)||"—":"N/A");return(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:bg-gray-50 transition duration-150 ease-in-out",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-800",children:e}),r?(0,s.jsxs)("p",{className:"text-sm font-semibold ".concat(n," inline-flex items-center px-2 py-1 rounded-full"),title:h,children:[i,r]}):(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"No status"})]},e)})})]},t)})})})]})}},14130:(e,t,a)=>{a.d(t,{II:()=>s,fb:()=>r,hd:()=>i,lB:()=>n});let s=["Meskerem","Tikimt","Hidar","Tahsas","Tir","Yekatit","Megabit","Miyazia","Ginbot","Sene","Hamle","Nehase","Pagumē"];function r(e){let t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate();return"".concat(s,"/").concat(a,"/").concat(t-7)}function n(e){let[t,a,s]=e.split("/").map(Number);return new Date(s+7,a-1,t)}function i(e){let t=parseInt(e),a=[];for(let e=1;e<=12;e++)for(let s=1;s<=30;s++)s%7==0&&a.push("".concat(s,"/").concat(e,"/").concat(t));return a}},23248:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(73365);function r(e){let{student:t}=e,a="".concat(t.First_Name," ").concat(t.Father_Name," ").concat(t.Grandfather_Name).trim(),r=t.Christian_Name?" (".concat(t.Christian_Name,")"):"",n=t.DOB_Date&&t.DOB_Month&&t.DOB_Year?"".concat(t.DOB_Date,"/").concat(t.DOB_Month,"/").concat(t.DOB_Year," (").concat(t.Age,")"):null;return(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg shadow-lg",children:[(0,s.jsx)("thead",{className:"bg-gray-300 text-gray-800 uppercase text-sm leading-normal",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border p-4 text-left",children:"Field"}),(0,s.jsx)("th",{className:"border p-4 text-left",children:"Value"})]})}),(0,s.jsxs)("tbody",{children:[t.Unique_ID&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"ID Number"}),(0,s.jsx)("td",{className:"border p-4",children:t.Unique_ID})]}),a&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Name"}),(0,s.jsxs)("td",{className:"border p-4",children:[a,r]})]}),n&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Date of Birth & Age"}),(0,s.jsx)("td",{className:"border p-4",children:n})]}),t.Sex&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Sex"}),(0,s.jsx)("td",{className:"border p-4",children:t.Sex})]}),t.Phone_Number&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Phone Number"}),(0,s.jsx)("td",{className:"border p-4",children:t.Phone_Number})]}),t.Grade&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Grade (Sunday School)"}),(0,s.jsx)("td",{className:"border p-4",children:t.Grade})]}),t.Occupation&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Occupation"}),(0,s.jsx)("td",{className:"border p-4",children:t.Occupation})]}),t.Class&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Class (World School)"}),(0,s.jsx)("td",{className:"border p-4",children:t.Class})]}),t.School||t.School_Other?(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"School"}),(0,s.jsx)("td",{className:"border p-4",children:t.School||t.School_Other})]}):null,t.Educational_Background&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Educational Background"}),(0,s.jsx)("td",{className:"border p-4",children:t.Educational_Background})]}),t.Address||t.Address_Other?(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Address"}),(0,s.jsx)("td",{className:"border p-4",children:t.Address||t.Address_Other})]}):null,t.Academic_Year&&(0,s.jsxs)("tr",{className:"hover:bg-gray-100 transition duration-150 ease-in-out",children:[(0,s.jsx)("td",{className:"border p-4 font-medium",children:"Academic Year"}),(0,s.jsx)("td",{className:"border p-4",children:t.Academic_Year})]})]})]})})}},72810:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(73365),r=a(14130),n=a(1521);function i(e){let{academicYear:t}=e,[a,i]=(0,n.useState)({}),[l,o]=(0,n.useState)(!0),[d,c]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{o(!0);try{let e=await fetch("/api/payment?year=".concat(t));if(!e.ok)throw Error("Network response was not ok");let a=await e.json(),s=r.II.reduce((e,t)=>(e[t]="Paid"===a[t]?"Paid":"Not Paid",e),{});i(s)}catch(e){console.error("Failed to load data:",e),h("❌ Failed to load payment data.")}finally{o(!1)}})()},[t]);let u=e=>{i(t=>({...t,[e]:"Paid"===t[e]?"Not Paid":"Paid"}))},x=async()=>{c(!0),h(null);try{if(!(await fetch("/api/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:t,data:a})})).ok)throw Error("Failed to save");h("✅ Payment status saved successfully.")}catch(e){console.error(e),h("❌ Error saving payment status.")}finally{c(!1)}};return l?(0,s.jsx)("p",{className:"text-gray-600",children:"Loading payment status..."}):(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Payment Status for Academic Year ",t]}),(0,s.jsx)("button",{onClick:x,disabled:d,className:"px-6 py-2 rounded-lg font-semibold text-white transition ".concat(d?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:d?"Saving...":"Save Changes"})]}),m&&(0,s.jsx)("p",{className:"mb-4 text-sm font-medium ".concat(m.startsWith("✅")?"text-green-600":"text-red-600"),children:m}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:r.II.map(e=>{let t="Paid"===a[e];return(0,s.jsxs)("div",{className:"border rounded-xl p-4 transition-shadow shadow-sm hover:shadow-md ".concat(t?"bg-green-100 border-green-400":"bg-red-100 border-red-400"),children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:e}),(0,s.jsxs)("label",{className:"flex items-center mt-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:t,onChange:()=>!t&&u(e),className:"mr-2",disabled:t}),(0,s.jsx)("span",{className:"text-sm ".concat(t?"text-green-700":"text-red-700"),children:t?"Paid":"Not Paid"})]})]},e)})})]})}}}]);